"use strict";(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[350],{2568:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(21294);class o{constructor(e){this.component_ready_promise=new Promise((e=>this._component_ready_resolve_fn=e)),this.optional=!1,void 0===window.allComponents&&(window.allComponents=[]),window.allComponents.push(this),e&&(this.sid=e.sid,this.graderactive=e.graderactive,this.showfeedback=!0,e.timed&&(this.isTimed=!0),e.enforceDeadline&&(this.deadline=e.deadline),$(e.orig).data("optional")?this.optional=!0:this.optional=!1,e.selector_id&&(this.selector_id=e.selector_id),void 0!==e.assessmentTaken?this.assessmentTaken=e.assessmentTaken:this.assessmentTaken=!0,void 0!==e.timedWrapper?this.timedWrapper=e.timedWrapper:location.href.indexOf("doAssignment")>=0?this.timedWrapper=$("h1#assignment_name").text():this.timedWrapper=null,$(e.orig).data("question_label")&&(this.question_label=$(e.orig).data("question_label"))),this.jsonHeaders=new Headers({"Content-type":"application/json; charset=utf-8",Accept:"application/json"})}async logBookEvent(e){if(this.graderactive)return;let t;return e.course_name=eBookConfig.course,e.clientLoginStatus=eBookConfig.isLoggedIn,e.timezoneoffset=(new Date).getTimezoneOffset()/60,this.percent&&(e.percent=this.percent),eBookConfig.useRunestoneServices&&eBookConfig.logLevel>0&&(t=this.postLogMessage(e)),this.isTimed&&!eBookConfig.debug||console.log("logging event "+JSON.stringify(e)),this.selector_id&&(e.div_id=this.selector_id.replace("-toggleSelectedQuestion",""),e.event="selectquestion",e.act="interaction",this.postLogMessage(e)),"function"==typeof s.j.updateProgress&&"edit"!=e.act&&0==this.optional&&s.j.updateProgress(e.div_id),t}async postLogMessage(e){var t;let i=new Request(`${eBookConfig.new_server_prefix}/logger/bookevent`,{method:"POST",headers:this.jsonHeaders,body:JSON.stringify(e)});try{let e=await fetch(i);if(!e.ok){if(422===e.status)throw t=await e.json(),console.log(t.detail),new Error("Unprocessable Request");if(401==e.status)throw t=await e.json(),console.log(`Missing authentication token ${t.detail}`),new Error("Missing authentication token");throw new Error("Failed to save the log entry")}t=e.json()}catch(e){this.isTimed&&alert(`Error: Your action was not saved! The error was ${e}`),console.log(`Error: ${e}`)}return t}async logRunEvent(e){let t="done";if(!this.graderactive){if(e.course=eBookConfig.course,e.clientLoginStatus=eBookConfig.isLoggedIn,e.timezoneoffset=(new Date).getTimezoneOffset()/60,(this.forceSave||"to_save"in e==0)&&(e.save_code="True"),eBookConfig.useRunestoneServices&&eBookConfig.logLevel>0){let i=new Request(`${eBookConfig.new_server_prefix}/logger/runlog`,{method:"POST",headers:this.jsonHeaders,body:JSON.stringify(e)}),s=await fetch(i);if(!s.ok)throw new Error("Failed to log the run");t=await s.json()}return this.isTimed&&!eBookConfig.debug||console.log("running "+JSON.stringify(e)),"function"==typeof s.j.updateProgress&&0==this.optional&&s.j.updateProgress(e.div_id),t}}async checkServer(e,t=!1){let i=this;if(this.checkServerComplete=new Promise((function(e,t){i.csresolver=e})),eBookConfig.isLoggedIn&&(this.useRunestoneServices||this.graderactive)){let t={};if(t.div_id=this.divid,t.course=eBookConfig.course,t.event=e,this.graderactive&&this.deadline&&(t.deadline=this.deadline,t.rawdeadline=this.rawdeadline,t.tzoff=this.tzoff),this.sid&&(t.sid=this.sid),t.div_id&&t.course&&t.event||console.log(`A required field is missing data ${t.div_id}:${t.course}:${t.event}`),eBookConfig.practice_mode||eBookConfig.peer||!this.assessmentTaken)this.loadData({}),this.csresolver("not taken");else{let e=new Request(`${eBookConfig.new_server_prefix}/assessment/results`,{method:"POST",body:JSON.stringify(t),headers:this.jsonHeaders});try{let i=await fetch(e);i.ok?(t=await i.json(),t=t.detail,this.repopulateFromStorage(t),this.csresolver("server")):(console.log(`HTTP Error getting results: ${i.statusText}`),this.checkLocalStorage(),this.csresolver("local"))}catch(e){try{this.checkLocalStorage()}catch(e){console.log(e)}}}}else this.checkLocalStorage(),this.csresolver("local");t&&this.indicate_component_ready()}indicate_component_ready(){this.containerDiv.classList.add("runestone-component-ready"),this._component_ready_resolve_fn()}loadData(e){return null}repopulateFromStorage(e){null!==e&&"no data"!==e&&this.shouldUseServer(e)?(this.restoreAnswers(e),this.setLocalStorage(e)):this.checkLocalStorage()}shouldUseServer(e){if("T"===e.correct||0===localStorage.length||!0===this.graderactive||this.isTimed)return!0;let t,i=localStorage.getItem(this.localStorageKey());if(null===i)return!0;try{t=JSON.parse(i)}catch(e){return console.log(e.message),localStorage.removeItem(this.localStorageKey()),!0}if(e.answer==t.answer)return!0;let s=new Date(t.timestamp);return new Date(e.timestamp)>=s}localStorageKey(){return eBookConfig.email+":"+eBookConfig.course+":"+this.divid+"-given"}addCaption(e){if(!this.isTimed){var t=document.createElement("p");this.question_label?(this.caption=`Activity: ${this.question_label} ${this.caption}  <span class="runestone_caption_divid">(${this.divid})</span>`,$(t).html(this.caption),$(t).addClass(`${e}_caption`)):($(t).html(this.caption+" ("+this.divid+")"),$(t).addClass(`${e}_caption`),$(t).addClass(`${e}_caption_text`)),this.capDiv=t,this.containerDiv.appendChild(t)}}hasUserActivity(){return this.isAnswered}checkCurrentAnswer(){console.log("Each component should provide an implementation of checkCurrentAnswer")}async logCurrentAnswer(){console.log("Each component should provide an implementation of logCurrentAnswer")}renderFeedback(){console.log("Each component should provide an implementation of renderFeedback")}disableInteraction(){console.log("Each component should provide an implementation of disableInteraction")}toString(){return`${this.constructor.name}: ${this.divid}`}queueMathJax(e){"2"===MathJax.version.substring(0,1)?MathJax.Hub.Queue(["Typeset",MathJax.Hub,e]):MathJax.typesetPromise([e])}}window.RunestoneBase=o},37350:(e,t,i)=>{i.r(t),i.d(t,{pollList:()=>o,default:()=>n});var s=i(2568),o={};class n extends s.Z{constructor(e){super(e);var t=e.orig;this.origElem=t,this.divid=t.id,this.children=this.origElem.childNodes,this.optionList=[],this.optsArray=[],this.comment=!1,$(this.origElem).is("[data-comment]")&&(this.comment=!0),this.resultsViewer=$(t).data("results"),this.getQuestionText(),this.getOptionText(),this.renderPoll(),this.checkPollStorage(),this.caption="Poll",this.addCaption("runestone")}getQuestionText(){for(var e,t=0;t<this.children.length;t++)if("LI"==this.children[t].tagName){e=this.children[t];break}var i=e.outerHTML,s=$(this.origElem).html().split(i);this.question=s[0]}getOptionText(){for(var e=this,t=0;t<this.children.length;t++)"LI"==e.children[t].tagName&&e.optionList.push($(e.children[t]).text())}renderPoll(){this.containerDiv=document.createElement("div"),this.pollForm=document.createElement("form"),this.resultsDiv=document.createElement("div"),this.containerDiv.id=this.divid,$(this.containerDiv).addClass(this.origElem.getAttribute("class")),$(this.pollForm).html(`<span style='font-size: Large'>${this.question}</span>`),$(this.pollForm).attr({id:this.divid+"_form",method:"get",action:"",onsubmit:"return false;"}),this.pollForm.appendChild(document.createElement("br"));for(var e=0;e<this.optionList.length;e++){var t=document.createElement("input"),i=this.divid+"_opt_"+e;$(t).attr({id:i,name:this.divid+"_group1",type:"radio",value:e}),$(t).click(this.submitPoll.bind(this));var s=document.createElement("label");$(s).attr("for",i),$(s).text(this.optionList[e]),this.pollForm.appendChild(t),this.optsArray.push(t),this.pollForm.appendChild(s),this.pollForm.appendChild(document.createElement("br"))}this.comment&&this.renderTextField(),this.resultsDiv.id=this.divid+"_results",this.containerDiv.appendChild(this.pollForm),this.containerDiv.appendChild(this.resultsDiv),$(this.origElem).replaceWith(this.containerDiv)}renderTextField(){this.textfield=document.createElement("input"),this.textfield.type="text",$(this.textfield).addClass("form-control"),this.textfield.style.width="300px",this.textfield.name=this.divid+"_comment",this.textfield.placeholder="Any comments?",this.pollForm.appendChild(this.textfield),this.pollForm.appendChild(document.createElement("br"))}submitPoll(){for(var e=null,t=0;t<this.optsArray.length;t++)if(this.optsArray[t].checked){e=this.optsArray[t].value;break}if(null!==e){var i="";this.comment&&(i=this.textfield.value);var s={event:"poll",act:""!==i?e+":"+i:e,div_id:this.divid};if(this.logBookEvent(s),localStorage.setItem(this.divid,"true"),document.getElementById(`${this.divid}_sent`)?$(`#${this.divid}_sent`).html("<strong>Only Your last reponse is recorded</strong>"):$(this.pollForm).append(`<span id=${this.divid}_sent><strong>Thanks, your response has been recorded</strong></span>`),"all"===this.resultsViewer){var o={};o.div_id=this.divid,o.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/getpollresults`,o,this.showPollResults)}}}showPollResults(e){var t=(e=e.detail).total,i=e.opt_counts,s=(e.div_id,e.my_vote);if(s>-1&&(this.optsArray[s].checked="checked"),"all"===this.resultsViewer&&localStorage.getItem("true"===this.divid)||eBookConfig.isInstructor){$(this.resultsDiv).html(`<b>Results:</b> ${t} responses <br><br>`);var o=$(document.createElement("div"));$(o).addClass("results-container");for(var n=0;n<this.optionList.length;n++){var r,a;i[n]>0?a=(r=i[n])/t*100:(r=0,a=0);var l=r+" ("+Math.round(10*a)/10+"%)",d=$(a>10?`<div class="progresscounter">${n+1}. </div><div class='progress'><div class='progress-bar progress-bar-success'style="width: ${a}%; min-width: 2em;"><span class='poll-text'>`+l+"</span></div></div>":`<div class="progresscounter">${n+1}. </div><div class='progress'><div class='progress-bar progress-bar-success'style="width: ${a}%; min-width: 2em;"></div><span class='poll-text' style='margin: 0 0 0 10px;'>`+l+"</span></div>");o.append(d)}$(this.resultsDiv).append(o)}this.indicate_component_ready()}disableOptions(){}checkPollStorage(){if(localStorage.length>0){var e={};e.div_id=this.divid,e.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/getpollresults`,e,this.showPollResults.bind(this)).fail(this.indicate_component_ready.bind(this))}else this.indicate_component_ready()}}$(document).bind("runestone:login-complete",(function(){$("[data-component=poll]").each((function(e){try{o[this.id]=new n({orig:this})}catch(e){console.log(`Error rendering Poll Problem ${this.id}\n                         Details: ${e}`),console.log(e.stack)}}))})),void 0===window.component_factory&&(window.component_factory={}),window.component_factory.poll=function(e){return new n(e)}}}]);
//# sourceMappingURL=350.6fe50f6e3334a077.bundle.js.map