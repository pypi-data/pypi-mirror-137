{% extends layout or "body.html" %}
{% block content %}
<div id="page_content">
    The following string is the <b>hash of the random number signature</b> generated by the server:<br><br>

    <b>{{ data.rand_hash | safe }}</b><br><br>

    Copy the string to compare it with the one in the <b>DICE Receipt</b>, which you will receive after the submission of the {{ data.data_type == 'co2mpas' and 'correlation' or 'JET' | safe }} output report.<br>
    To verify the random number generated by the server follow the instructions in the <i>README.rst</i> file of the <b>DICE receipt</b> (.zip).<br>
    <h3>Uploaded data:</h3>
    <h4>Info</h4>
    {{ pd.DataFrame(**data.tables.info).rename(index={
        'CO2MPAS_version': 'CO<sub>2</sub>MPAS version',
        'JET_version': 'JET version',
        'DICE_version': 'DICE version',
        'SCHEMA_version': 'SCHEMA version',
        'datetime': 'Execution Datetime',
        'uploaded_file_name': 'Uploaded Filename',
        'vehicle_family_id': 'Vehicle Family ID'
       }).to_html(header=False, table_id='info', escape=False) | safe }}<br>
    <h4>Vehicle</h4>
    {{ pd.DataFrame(**data.tables.vehicle).rename(index={
        'co2_deviation': 'CO<sub>2</sub> Deviation [%]',
        'delta_state_of_charge': 'Service Battery Δsoc [%]',
        'service_battery_delta_state_of_charge': 'Service Battery Δsoc [%]',
        'drive_battery_delta_state_of_charge': 'Drive Battery Δsoc [%]',
        'engine_capacity': 'Engine Capacity [cc]',
        'engine_is_turbo': 'Is Turbo?',
        'engine_max_power': 'Engine Nominal Power [kW]',
        'engine_speed_at_max_power': 'Engine Speed at Nominal Power [RPM]',
        'fuel_type': 'Fuel Type',
        'gear_box_type': 'Gearbox',
       }, columns={
        'nedc_h': 'NEDC-H',
        'nedc_l': 'NEDC-L',
        'wltp_h': 'WLTP-H',
        'wltp_l': 'WLTP-L',
        'wltp_m': 'WLTP-M'
       }).to_html(table_id='vehicle', escape=False) | safe }}<br>
    {% if 'ratios' in data.tables %}
    <h4>Ratios</h4>
    {{ pd.DataFrame(**data.tables.ratios).rename(columns={
        'declared_wltp_h_vs_corrected_wltp_h': 'Declared/Corrected WLTP-H',
        'declared_wltp_h_vs_declared_nedc_h': 'Declared WLTP-H/NEDC-H',
        'declared_wltp_l_vs_corrected_wltp_l': 'Declared/Corrected WLTP-L',
        'declared_wltp_l_vs_declared_nedc_l': 'Declared WLTP-L/NEDC-L'
       }).to_html(index=False, table_id='ratios') | safe }}<br>
    {% endif %}
    {% if 'scores' in data.tables %}
    <h4>Scores</h4>
    {{ pd.DataFrame(
        data.tables.scores.data,
        columns=pd.MultiIndex.from_tuples(data.tables.scores.columns),
        index=pd.MultiIndex.from_tuples(data.tables.scores.index, names=['Model', 'Param'])
    ).rename(index={
        'alternator_model': 'Alternator',
        'clutch_torque_converter_model': 'Clutch/Torque Converter',
        'co2_params': 'CO<sub>2</sub>params',
        'engine_cold_start_speed_model': 'Engine Cold Start Speed',
        'engine_coolant_temperature_model': 'Coolant Temperature',
        'engine_speed_model': 'Engine Speed',
        'start_stop_model': 'Start/Stop',

        'control_model': 'Controller',
        'electrics_model': 'Electrics',
        'after_treatment_model': 'After Treatment'
       }, columns={
        'wltp_h': 'WLTP-H',
        'wltp_l': 'WLTP-L'
       }, level=0).rename(index={
        'alternator_currents': 'Alternator Currents [A]',
        'alternator_statuses': 'Alternator Statuses [-]',
        'battery_currents': 'Service Battery Currents [A]',
        'state_of_charges': 'Service Battery SOC [%]',
        'gears': 'Gears [-]',
        'engine_speeds_out': 'Engine Speed [RPM]',
        'calibration_status': 'Status [-]',
        'identified_co2_emissions': 'Identified CO<sub>2</sub> [CO<sub>2</sub>g]',
        'engine_coolant_temperatures': 'Coolant Temperature [°C]',
        'engine_starts': 'Engine Starts [-]',
        'on_engine': 'On Engine [-]',

        'engine_speeds_base': 'Engine Speed [RPM]',
        'dcdc_converter_currents': 'DC/DC Converter Currents [A]',
        'service_battery_currents': 'Service Battery Currents [A]',
        'drive_battery_currents': 'Drive Battery Currents [A]',
        'service_battery_state_of_charges': 'Service Battery SOC [%]',
        'drive_battery_state_of_charges': 'Drive Battery SOC [%]',
       }, columns={
        'wltp_h': 'WLTP-H',
        'wltp_l': 'WLTP-L',
        'wltp_m': 'WLTP-M'
       }, level=1).to_html(table_id='scores', escape=False) | safe}}<br>
    {% endif %}
    <h4>Hashes</h4>
    {{ pd.DataFrame(**data.tables.hash).rename(index={
        'dice': 'DICE Data',
        'dice_report': 'DICE Report Data',
        'input_file': 'Input File',
        'inputs': (data.data_type == 'co2mpas' and 'CO<sub>2</sub>MPAS' or 'JET') + ' Input Data',
        'meta': 'Meta Data',
        'output_file': 'Output File',
        'target_wltp': 'WLTP targets',
        'target_nedc': 'NEDC targets',
        'outputs': 'CO<sub>2</sub>MPAS Output Data',
        'ta_file': '*.%s.ta File' % (data.data_type),
        'tot': data.data_type == 'co2mpas' and 'Correlation (i.e., *.co2mpas.zip)' or 'JET (i.e., *.jet.zip)'
       }).to_html(header=False, table_id='hash', escape=False) | safe }}
    <br>
</div>
<form action="/submit/{{ data.ecas_id | safe }}/{{ data.session | safe }}" id="next_action">
    <input type="submit" value="Submit">
</form>
{% endblock %}