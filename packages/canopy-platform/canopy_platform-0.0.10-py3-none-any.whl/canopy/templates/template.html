$def with (resource)
$ path = tx.request.uri.path
$ owner = tx.host.owner
<html class=dark>
<head>
<meta charset=utf-8>
<meta name=generator content=canopy>
<meta name=viewport content="initial-scale=1.0,user-scalable=no,\
maximum-scale=1,width=device-width">
<title>\
$if "title" in resource:
    $:resource.title&thinsp;&mdash;&thinsp;\
$owner["name"][0]</title>
$# <script src=/static/canopy.js crossorigin=anonymous></script>
$# <script>const _ = Canopy('$owner["name"][0]')</script>
$if not isinstance(resource, str) and "head" in resource:
    $:resource.head()
</head>
<body>
<article id=content \
$if "classes" in resource:
     class="$resource.classes"\
>
$if "prefix" in resource:
    $:resource.prefix
<div class=article>
$if path:
    $ sep = "&ensp;<span class=crumb-sep>&#x25b8;</span>"
    $ post_sep = "&ensp;"
    $# <a rel="home index" href=/>Home</a>$:sep
    $if "breadcrumbs" in resource:
        <p class=breadcrumbs>\
        $ breadcrumbs = resource["breadcrumbs"]
        $ n = int(len(breadcrumbs) / 2)
        $ top_ups = " ".join(["up"] * (n + 1))
        $ hierarchy = ""
        $for bc_path, crumb_title in zip(*(breadcrumbs[i::2] for i in (0, 1))):
            $ bc_path = str(bc_path)
            $ crumb_title = str(crumb_title)
            $if "absolute_breadcrumbs" in resource:
                $ hierarchy = ""
            $ hierarchy += "/" + bc_path
            $ crumb_icon = None
            $if isinstance(crumb_title, tuple):
                $ crumb_icon, crumb_title = crumb_title
            <span>\
            $if crumb_icon:
                <span class="fa fa-$crumb_icon"></span>&thinsp;\
            <a href=$hierarchy
            rel="$(" ".join(["up"] * n))">$:crumb_title</a>$:sep</span>$:post_sep\
            $ n -= 1
        </p>
<header>
$if "title" in resource and getattr(resource, "show_title", True):
    <h1>$:resource.title</h1>
$if "header" in resource:
    $:resource.header()
</header>
<div>
$:resource
</div>
<aside>
$if "aside" in resource:
    $:resource.aside()
</aside>
</div>
$if "suffix" in resource:
    $:resource.suffix
</article>
<nav id=site>
<div class=h-card>
<strong><big class=p-name><a class="u-url u-uid"
href=$owner["uid"][0]>$owner["name"][0]</a></big></strong>
$ note = owner.get("note")
$if note:
    <p>$note[0]</p>
<ul class=elsewhere>
$for url in owner.get("url", []):
    $if tx.request.uri.host in url:
        $continue
    <li>
    $for service, pattern in SILOS.items():
        $ match = re.match(pattern, url)
        $if match:
            <a rel=me href=$url title=$service><img
            src=/static/logos/$(service.lower()).svg alt=$service
            style="height:1em"><span>$match.groupdict()["user"]</span></a>
            $break
    $else:
        <a rel=me href=$url>$url</a>
    </li>
</ul>
<!--p style=text-align:right><small><a href=/about>more about me</a></small></p-->
</div>
$if not getattr(tx.user, "is_authenticating", False) and path != "sign-in":
    $if "uid" in tx.user.session:
        $if tx.user.is_owner:
            $ action = "/owner/sign-out"
        $else:
            $ action = "/guests/sign-out"
        <form id=user method=post action=$action>
        <input type=hidden name=return_to value=$path>
        $if not tx.user.is_owner:
            <p><strong>$tx.user.session["name"]</strong><br>
            <small>$tx.user.session["uid"].partition("//")[2]</small></p>
        <button>Sign Out</button>
        </form>
    $elif path != "sign-in":
        <form action=/sign-in><input type=hidden name=return_url value="$path">
        <button>Sign In</button>
        </form>
<ul>
<li><a href=/posts>Posts</a></li>
<li><a href=/people>People</a></li>
</ul>
$if not path.startswith("search"):
    <form action=/search>
    <label class=bounding><input type=text name=q></label>
    <div class=buttons><button>Search</button></div>
    </form>
$if tx.user.session and tx.user.is_owner:
    <ul class=admin>
    <li><a href=/owner>Owner</a></li>
    <li><a href=/guests>Guests</a></li>
    <li><a href=/mentions>Mentions</a></li>
    <li><a href=/subscriptions>Subscriptions</a></li>
    <li><a href=/auth>Authorizations</a></li>
    <li><a href=/system>System</a></li>
    <li><a href=/sites>Sites</a></li>
    </ul>
</nav>
<link rel=stylesheet href=/static/screen.css media=screen>
</body>
</html>
