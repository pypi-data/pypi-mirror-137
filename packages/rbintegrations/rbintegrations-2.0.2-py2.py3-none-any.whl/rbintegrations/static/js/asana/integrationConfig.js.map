{"version":3,"sources":["integrationConfig.es6.js"],"names":[],"mappings":"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","file":"integrationConfig.js","sourcesContent":["$(function() {\n    const $accessToken = $('#id_asana_access_token');\n    const $workspace = $('#id_asana_workspace');\n    const $error = $('<div class=\"errorlist\">')\n        .insertAfter($accessToken)\n        .hide();\n\n    $workspace.selectize({\n        create: false,\n        dropdownParent: 'body',\n        searchField: 'name',\n        valueField: 'id',\n        labelField: 'name',\n        render: {\n            option(item, escape) {\n                return `<div>${escape(item.name)}</div>`;\n            },\n        },\n        onChange(value) {\n            $('#id_asana_workspace_name').val(this.options[value].name);\n        },\n    });\n\n    const selectize = $workspace[0].selectize;\n    selectize.$control.width($('#id_name').width());\n    selectize.disable();\n\n    function showError(errorStr) {\n        $error\n            .html(dedent`\n                <span class=\"rb-icon rb-icon-warning\"></span>\n                ${_.escape(errorStr)}\n            `)\n            .show();\n    }\n\n    let lastKey = null;\n\n    const changeWorkspaceEnabled = _.throttle(() => {\n        const apiKey = $accessToken.val().trim();\n\n        if (lastKey === apiKey) {\n            return;\n        }\n\n        lastKey = apiKey;\n        $error.hide();\n        selectize.disable();\n\n        if (apiKey.length === 0) {\n            return;\n        }\n\n        selectize.load(callback => {\n            const params = $.param({ api_key: apiKey });\n\n            $.ajax({\n                url: `${SITE_ROOT}rbintegrations/asana/workspaces/?${params}`,\n                type: 'GET',\n                success(res) {\n                    if (res.result === 'success') {\n                        selectize.enable();\n                        callback(res.data);\n                    } else if (res.result === 'error') {\n                        showError(res.error);\n                        callback();\n                    } else {\n                        console.error('Unexpected error when fetching ' +\n                                      'Asana workspace list',\n                                      res);\n                        showError('Unable to communicate with Asana');\n                        callback();\n                    }\n                },\n                error(xhr, textStatus, errorThrown) {\n                    console.error('Unexpected error when fetching ' +\n                                  'Asana workspace list',\n                                  xhr);\n                    showError('Unable to communicate with Asana');\n                    callback();\n                },\n            });\n        });\n    }, 100);\n\n    $accessToken.on('change keyup', changeWorkspaceEnabled);\n    changeWorkspaceEnabled();\n});\n"]}