{"version":3,"sources":["extensionManagerModel.es6.js"],"names":[],"mappings":"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","file":"extensionManagerModel.js","sourcesContent":["(function() {\n\n\n/**\n * Represents an installed extension listed in the Manage Extensions list.\n *\n * This stores the various information about the extension that we'll display\n * to the user, and offers actions for enabling or disabling the extension.\n */\nconst InstalledExtension = Backbone.Model.extend({\n    defaults: {\n        author: null,\n        authorURL: null,\n        configURL: null,\n        dbURL: null,\n        enabled: false,\n        loadable: true,\n        loadError: null,\n        name: null,\n        summary: null,\n        version: null,\n    },\n\n    /**\n     * Return the URL to the API endpoint representing this extension.\n     *\n     * Returns:\n     *     string:\n     *     The URL to use for making changes to this extension.\n     */\n    url() {\n        return Backbone.Model.prototype.url.call(this) + '/';\n    },\n\n    /**\n     * Enable the extension.\n     *\n     * This will submit a request to the server to enable this extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise that will be resolved when the request to enable the\n     *     extension completes.\n     */\n    enable() {\n        return new Promise((resolve, reject) => {\n            this.save({\n                enabled: true\n            }, {\n                wait: true,\n                success: () => resolve(),\n                error: (model, xhr) => {\n                    this.set({\n                        loadable: false,\n                        loadError: xhr.errorRsp.load_error,\n                        canEnable: !xhr.errorRsp.needs_reload,\n                    });\n\n                    reject(new Error(xhr.errorText));\n                },\n            });\n        });\n    },\n\n    /**\n     * Disable the extension.\n     *\n     * This will submit a request to the server to disable this extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise that will be resolved when the request to enable the\n     *     extension completes.\n     */\n    disable() {\n        return new Promise((resolve, reject) => {\n            this.save({\n                enabled: false,\n            }, {\n                wait: true,\n                success: () => resolve(),\n                error: xhr => reject(new Error(xhr.errorText)),\n            });\n        });\n    },\n\n    /**\n     * Return a JSON payload for requests sent to the server.\n     *\n     * Returns:\n     *     object:\n     *     A payload that will be serialized for making the API request.\n     */\n    toJSON() {\n        return {\n            enabled: this.get('enabled'),\n        };\n    },\n\n    /**\n     * Parse a JSON payload from the server.\n     *\n     * Args:\n     *     rsp (object):\n     *         The payload from the server.\n     *\n     * Returns:\n     *     object:\n     *     The parsed response.\n     */\n    parse(rsp) {\n        if (rsp.stat !== undefined) {\n            rsp = rsp.extension;\n        }\n\n        const configLink = rsp.links['admin-configure'];\n        const dbLink = rsp.links['admin-database'];\n\n        return {\n            author: rsp.author,\n            authorURL: rsp.author_url,\n            canDisable: rsp.can_disable,\n            canEnable: rsp.can_enable,\n            configURL: configLink ? configLink.href : null,\n            dbURL: dbLink ? dbLink.href : null,\n            enabled: rsp.enabled,\n            loadable: rsp.loadable,\n            loadError: rsp.load_error,\n            id: rsp.class_name,\n            name: rsp.name,\n            summary: rsp.summary,\n            version: rsp.version,\n        };\n    },\n\n    /**\n     * Perform AJAX requests against the server-side API.\n     *\n     * Args:\n     *     method (string):\n     *         The HTTP method to use.\n     *\n     *     model (InstalledExtension):\n     *         The extension object being synced.\n     *\n     *     options (object):\n     *         Options for the sync operation.\n     */\n    sync(method, model, options) {\n        Backbone.sync.call(this, method, model, _.defaults({\n            contentType: 'application/x-www-form-urlencoded',\n            data: model.toJSON(options),\n            processData: true,\n            error: xhr => {\n                let rsp;\n                let text;\n\n                try {\n                    rsp = $.parseJSON(xhr.responseText);\n                    text = rsp.err.msg;\n                } catch (e) {\n                    text = 'HTTP ' + xhr.status + ' ' + xhr.statusText;\n                    rsp = {\n                        loadError: text,\n                        canEnable: false,\n                    };\n                }\n\n                if (_.isFunction(options.error)) {\n                    xhr.errorText = text;\n                    xhr.errorRsp = rsp;\n                    options.error(xhr, options);\n                }\n            },\n        }, options));\n    },\n});\n\n\n/**\n * A collection of installed extensions.\n *\n * This stores the list of installed extensions, and allows fetching from\n * the API.\n */\nconst InstalledExtensionCollection = Backbone.Collection.extend({\n    model: InstalledExtension,\n\n    /**\n     * Parse the response from the server.\n     *\n     * Args:\n     *     rsp (object):\n     *         The response from the server.\n     *\n     * Returns:\n     *     object:\n     *     The parsed data from the response.\n     */\n    parse(rsp) {\n        return rsp.extensions;\n    },\n});\n\n\n/**\n * Manages installed extensions.\n *\n * This stores a collection of installed extensions, and provides\n * functionality for loading the current list from the server.\n *\n * Model Attributes:\n *     apiRoot (string):\n *         The root of the extensions API, used for all lookups.\n */\nDjblets.ExtensionManager = Backbone.Model.extend({\n    defaults: {\n        apiRoot: null,\n    },\n\n    /**\n     * Initialize the manager.\n     */\n    initialize() {\n        this.installedExtensions = new InstalledExtensionCollection();\n        this.installedExtensions.url = this.get('apiRoot');\n    },\n\n    /**\n     * Load the extensions list.\n     */\n    load() {\n        this.trigger('loading');\n\n        this.installedExtensions.fetch({\n            success: () => this.trigger('loaded'),\n        });\n    },\n});\n\n\n})();\n"]}