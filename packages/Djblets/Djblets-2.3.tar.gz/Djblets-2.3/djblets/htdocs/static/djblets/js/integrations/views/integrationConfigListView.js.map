{"version":3,"sources":["integrationConfigListView.es6.js"],"names":[],"mappings":"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","file":"integrationConfigListView.js","sourcesContent":["(function() {\n\n\n/**\n * List item for a configuration.\n *\n * This stores basic display, actions, and API information for the\n * configuration.\n */\nconst IntegrationConfigItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        removeLabel: _`Delete`,\n        showRemove: true,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Return the API URL for the item.\n     *\n     * This is the same as the ``editURL`` attribute, and is used to\n     * perform HTTP DELETE requests.\n     *\n     * Returns:\n     *     string:\n     *     The URL to perform API operations on.\n     */\n    url() {\n        return this.get('editURL');\n    },\n\n    /**\n     * Return the attributes for this item from a provided payload.\n     *\n     * Args:\n     *     data (object):\n     *         The data for this item provided when constructing the\n     *         integrations page.\n     *\n     * Returns:\n     *     object:\n     *     The new attribute data from the item.\n     */\n    parse(data) {\n        return {\n            editURL: data.editURL,\n            id: data.id,\n            integrationID: data.integrationID,\n            itemState: data.enabled ? 'enabled' : 'disabled',\n            name: data.name,\n        };\n    },\n});\n\n\n/**\n * View for displaying information and actions for a configuration.\n *\n * This renders some basic information on the state of the configuration,\n * and provides actions for deleting configurations.\n */\nconst IntegrationConfigItemView = Djblets.Config.TableItemView.extend({\n    className:\n        'djblets-c-integration-config djblets-c-config-forms-list__item',\n\n    actionHandlers: {\n        'delete': '_onDeleteClicked',\n    },\n\n    template: _.template(dedent`\n        <td class=\"djblets-c-integration-config__name\">\n         <img src=\"<%- iconSrc %>\"\n              srcset=\"<%- iconSrcSet %>\"\n              width=\"32\" height=\"32\" alt=\"\">\n         <a href=\"<%- editURL %>\"><%- name %></a>\n        </td>\n        <td class=\"djblets-c-integration-config__integration-name\">\n         <%- integrationName %>\n        </td>\n        <td class=\"djblets-c-config-forms-list__item-state\"></td>\n        <td></td>\n    `),\n\n    /**\n     * Return context data for rendering the item's template.\n     *\n     * Returns:\n     *     object:\n     *     Context data for the render.\n     */\n    getRenderContext() {\n        const integrationID = this.model.get('integrationID');\n        const integration =\n            this.model.collection.options.integrationsMap[integrationID];\n\n        return {\n            iconSrc: integration.iconSrc,\n            iconSrcSet: integration.iconSrcSet,\n            integrationName: integration.name,\n        };\n    },\n\n    /**\n     * Handle the Delete action on the item.\n     *\n     * This will display a confirmation dialog, and then send an HTTP DELETE\n     * to remove the configuration.\n     */\n    _onDeleteClicked() {\n        $('<p>')\n            .text(_`\n                This integration will be permanently removed. This cannot\n                be undone.\n            `)\n            .modalBox({\n                title: _`Are you sure you want to delete this integration?`,\n                buttons: [\n                    $('<button>')\n                        .text(_`Cancel`),\n                    $('<button class=\"danger\">')\n                        .text(_`Delete Integration`)\n                        .click(() => this.model.destroy({\n                            beforeSend: xhr => {\n                                xhr.setRequestHeader(\n                                    'X-CSRFToken',\n                                    this.model.collection.options.csrfToken);\n                            },\n                        })),\n                ],\n            });\n    },\n});\n\n\n/**\n * View for managing the integration configurations list.\n *\n * This handles events for the Add Integration button and the resulting popup.\n */\nDjblets.IntegrationConfigListView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-integration-configs__add': '_onAddIntegrationClicked',\n    },\n\n    addIntegrationPopupViewType: Djblets.AddIntegrationPopupView,\n    listItemsCollectionType: Djblets.Config.ListItems,\n    listItemType: IntegrationConfigItem,\n    listViewType: Djblets.Config.TableView,\n    listItemViewType: IntegrationConfigItemView,\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     configs (Array):\n     *         An array of data on the configurations, in display order.\n     *\n     *     integrationIDs (Array):\n     *         An array of integration IDs, in display order.\n     *\n     *     integrationsMap (object):\n     *         A mapping of integration ID to information.\n     */\n    initialize(options) {\n        this._integrationIDs = options.integrationIDs;\n        this._integrationsMap = options.integrationsMap;\n\n        this.list = new Djblets.Config.List(\n            {},\n            {\n                collection: new this.listItemsCollectionType(\n                    options.configs,\n                    {\n                        csrfToken: options.csrfToken,\n                        integrationsMap: options.integrationsMap,\n                        model: this.listItemType,\n                        parse: true,\n                    }\n                ),\n            });\n\n        this._popup = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     Djblets.IntegrationConfigListView:\n     *     This view, for chaining.\n     */\n    render() {\n        this.listView = new this.listViewType({\n            el: this.$('.djblets-c-config-forms-list'),\n            model: this.list,\n            ItemView: this.listItemViewType,\n        });\n        this.listView.render().$el\n            .removeAttr('aria-busy');\n\n        this._$listContainer = this.listView.$el.parent();\n\n        this.listenTo(this.list.collection, 'add remove',\n                      this._showOrHideConfigsList);\n        this._showOrHideConfigsList();\n\n        return this;\n    },\n\n    /**\n     * Show or hide the list of configurations.\n     *\n     * This will show the list's container if there's at least one item to\n     * show, or hide it if the list is empty.\n     */\n    _showOrHideConfigsList() {\n        if (this.list.collection.length > 0) {\n            this._$listContainer.show();\n        } else {\n            this._$listContainer.hide();\n        }\n    },\n\n    /**\n     * Handler for the Add Integration button.\n     *\n     * This will show the integrations list popup, allowing the user to choose\n     * an integration to add.\n     *\n     * The logic for showing the popup will align the popup with the left-hand\n     * side of the Add Integration button, and set the width to the maximum\n     * amount that will cleanly fit a row of tiles without obscuring any part\n     * of a tile or leaving extra space after a tile.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onAddIntegrationClicked(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!this._popup) {\n            const integrationIDs = this._integrationIDs;\n            const integrationsMap = this._integrationsMap;\n            const integrations = [];\n\n            for (let i = 0; i < integrationIDs.length; i++) {\n                integrations.push(integrationsMap[integrationIDs[i]]);\n            }\n\n            this._popup = new this.addIntegrationPopupViewType({\n                integrations: integrations,\n            });\n            this._popup.render().$el.appendTo(this.$el);\n        }\n\n        this._popup.show($(e.target));\n    },\n});\n\n\n})();\n"]}