{"version":3,"sources":["listEditView.es6.js"],"names":[],"mappings":"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","file":"listEditView.js","sourcesContent":["(function() {\n\n\nconst entryTemplate = _.template(dedent`\n    <li class=\"djblets-c-list-edit-widget__entry\"\n        data-list-index=\"<%- index %>\">\n     <input type=\"text\"<%= inputAttrs %>>\n     <a href=\"#\" class=\"djblets-c-list-edit-widget__remove-item\"\n        role=\"button\" title=\"<%- removeText %>\">\n       <span class=\"fa fa-times\"></span>\n     </a>\n    </li>\n`);\n\n/**\n * A view for editing a list of elements.\n *\n * This is the JavaScript view for\n * :py:class:`djblets.forms.widgets.ListEditWidget`.\n */\nDjblets.Forms.ListEditView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-list-edit-widget__add-item': '_addItem',\n        'click .djblets-c-list-edit-widget__remove-item': '_removeItem',\n        'blur .djblets-c-list-edit-widget__input': '_onBlur',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         The view options.\n     *\n     * Option Args:\n     *     inputAttrs (string):\n     *         The attributes that should be added to each ``<input>`` element.\n     *\n     *     removeText (string):\n     *         The localized text for removing an item.\n     *\n     *     sep (string):\n     *         The list separator. It will be used to join the list of values\n     *         into a string.\n     */\n    initialize(options) {\n        this._inputAttrs = options.inputAttrs;\n        this._removeText = options.removeText;\n        this._sep = options.sep;\n        this._values = [];\n    },\n\n    /**\n     * Render the view.\n     *\n     * Since most of the view is rendered by Django, this just sets up some\n     * event listeners.\n     *\n     * Returns:\n     *     Djblets.Forms.ListEditView:\n     *     This view.\n     */\n    render() {\n        this.$el.data('djblets-list-edit-view', this);\n\n        this._$list = this.$el.children(\n            '.djblets-c-list-edit-widget__entries');\n        this._$list.find('.djblets-c-list-edit-widget__input')\n            .each((idx, el) => this._values.push($(el).val()));\n        this._$addBtn = this.$el.children(\n            '.djblets-c-list-edit-widget__add-item');\n        this._$hidden = this.$el.children(\n            '.djblets-c-list-edit-widget__value');\n\n        return this;\n    },\n\n    /**\n     * Add an item to the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _addItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $entry = $(entryTemplate({\n                index: this._values.length,\n                inputAttrs: this._inputAttrs,\n                removeText: this._removeText,\n            }))\n            .insertBefore(this._$addBtn);\n\n        $entry\n            .find('.djblets-c-list-edit-widget__add-item')\n                .on('click', e => this._addItem(e))\n            .end()\n            .find('.djblets-c-list-edit-widget__input')\n                .on('change', e => this._onBlur(e))\n            .end();\n\n        this._values.push('');\n    },\n\n    /**\n     * Remove an item.\n     *\n     * When there is only a single item in the list, we clear it instead of\n     * removing it so there is always at least one ``<input>`` element and\n     * value in the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _removeItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $target = $(e.target);\n        const $entry = $target.closest('.djblets-c-list-edit-widget__entry');\n        const index = $entry.attr('data-list-index');\n\n        if (this._values.length > 1) {\n            $entry.remove();\n            this._values.splice(index, 1);\n            this._$list.find('.djblets-c-list-edit-widget__entry')\n                .each((idx, el) => $(el).attr('data-list-index', idx));\n        } else {\n            this._values[index] = '';\n            $target.siblings('.djblets-c-list-edit-widget__input').val('');\n        }\n\n        this._$hidden\n            .val(this._values.filter(v => v.length > 0).join(this._sep));\n    },\n\n    /**\n     * Update the internal values when a field changes.\n     *\n     * Args:\n     *     e (Event):\n     *         The blur event.\n     */\n    _onBlur(e) {\n        const $target = $(e.target);\n        const index = $target\n            .closest('.djblets-c-list-edit-widget__entry')\n            .attr('data-list-index');\n\n        this._values[index] = $target.val();\n        this._$hidden\n            .val(this._values.filter(v => v.length > 0).join(this._sep));\n    },\n});\n\n\n})();\n"]}